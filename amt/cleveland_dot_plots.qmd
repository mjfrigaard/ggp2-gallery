---
title: "Cleveland Dot Plot"
format:
  html:
    toc: true
    code-fold: show
    out-height: '100%'
    out-width: '100%'
execute:
  warning: false
  message: false
---

```{r}
#| label: setup
#| message: false
#| warning: false
#| include: false
library(tidyverse)
library(lubridate)
library(scales)
library(knitr)
library(kableExtra)
library(colorblindr)
library(downlit)
# options ----
options(
  repos = "https://cloud.r-project.org",
  dplyr.print_min = 6, 
  dplyr.print_max = 6, 
  scipen = 9999)
# fonts ----
library(extrafont)
library(sysfonts)
# import font
extrafont::font_import(
    paths = "../assets/Ubuntu/",
    prompt = FALSE)
# add font
sysfonts::font_add(
    family =  "Ubuntu", 
    regular = "../assets/Ubuntu/Ubuntu-Regular.ttf")
# use font
showtext::showtext_auto()
# add theme
source("../R/theme_ggp2g.R")
# set theme
ggplot2::theme_set(theme_ggp2g(
    base_size = 14))
# install data packages ----
install.packages("palmerpenguins")
```



:::: {.callout-note collapse="false" icon=false}
## Graph info
::: {style="font-size: 1.25em; color: #02577A;"}
**Should I use this graph?**
:::

<br>

```{r}
#| label: full_code_display
#| eval: true
#| echo: false
#| warning: false
#| message: false
#| out-height: '60%'
#| out-width: '60%'
#| fig-align: right
library(palmerpenguins) 
library(ggplot2)
peng_clev_dots <- palmerpenguins::penguins |>
    dplyr::filter(!is.na(sex) & !is.na(flipper_length_mm)) |>
    dplyr::group_by(sex, island) |>
    dplyr::summarise(
        med_flip_length_mm = median(flipper_length_mm)
        ) |>
    dplyr::ungroup()
labs_clev_dots <- labs(
    title = "Flipper Length Differences",
    subtitle = "Male and female penguins",
    x = "Median Flipper Length",
    y = "Island",
    color = "Sex"
)

ggp2_clev_dots <- ggplot(data = peng_clev_dots,
    mapping = aes(x = med_flip_length_mm, y = fct_rev(island))) +
        geom_line(aes(group = island), linewidth = 0.75) + 
        geom_point(aes(color = sex), size = 2.25) 

ggp2_clev_dots + 
    labs_clev_dots
```

A Cleveland dot plot displays differences in a numerical variable for different levels of a categorical variable.

Typically, the graph contains two points representing the numerical value on the `y` axis, differentiated by color. A line connecting the two points represents the difference between the two categorical levels (the width of the line is the size of the difference).

::::

## Getting set up

:::: {.panel-tabset}

### Packages

::: {style="font-size: 0.90em; color: #1e83c8;"}
**PACKAGES:**
:::

::: {style="font-size: 0.85em;"}
Install packages.
:::


::: {style="font-size: 0.75em;"}
```{r}
#| label: pkg_code_clev_dots
#| eval: true
#| echo: true
#| warning: false
#| message: false
#| results: hide
install.packages("palmerpenguins")
library(palmerpenguins)
library(ggplot2)
```
:::

### Data

::: {style="font-size: 0.90em; color: #1e83c8;"}
**DATA:**
:::

::: {.column-margin}
![Artwork by @allison_horst](../www/lter_penguins.png){fig-align="right" width="100%" height="100%"}
:::

::: {style="font-size: 0.85em;"}
Remove missing values from `sex` and `flipper_length_mm` and group on `sex` and `island` to the calculate the median flipper length (`med_flip_length_mm`).
:::

::: {style="font-size: 0.75em;"}
```{r}
#| label: data_code_clev_dots
#| eval: true
#| echo: true
peng_clev_dots <- palmerpenguins::penguins |>
    dplyr::filter(!is.na(sex) & !is.na(flipper_length_mm)) |>
    dplyr::group_by(sex, island) |>
    dplyr::summarise(
        med_flip_length_mm = median(flipper_length_mm)
        ) |>
    dplyr::ungroup()
glimpse(peng_clev_dots)
```
:::
::::

## The grammar

:::: {.panel-tabset}

### Code

::: {style="font-size: 0.90em; color: #1e83c8;"}
**CODE:**
:::

::: {style="font-size: 0.85em;"}

Create labels with `labs()`

Map the `med_flip_length_mm` to the `x` axis, and `island` to the `y` axis, but wrap `island` in `forcats::fct_rev()`.

Add `geom_line()`, and map `island` to the `group` aesthetic. Set the `linewidth` to `0.75`

Add `geom_point()` and map `sex` to `color` aesthetic. Set the `size` to `2.25`

:::

::: {style="font-size: 0.75em;"}
```{r}
#| label: code_graph_clev_dots
#| eval: false
#| echo: true 
#| warning: false
#| message: false
#| column: page-inset-right
#| layout-nrow: 1
labs_clev_dots <- labs(
    title = "Flipper Length Differences",
    subtitle = "Male and female penguins",
    x = "Median Flipper Length",
    y = "Island",
    color = "Sex"
)

ggp2_clev_dots <- ggplot(data = peng_clev_dots,
                mapping = aes(x = med_flip_length_mm, 
                              y = fct_rev(island))) +
                geom_line(aes(group = island), 
                    linewidth = 0.75) + 
                geom_point(aes(color = sex), 
                    size = 2.25) 

ggp2_clev_dots + 
    labs_clev_dots
```
:::

### Graph

::: {style="font-size: 0.90em; color: #1e83c8;"}
**GRAPH:**
:::

```{r}
#| label: create_graph_clev_dots
#| eval: true
#| echo: false
#| warning: false
#| message: false
#| column: page-inset-right
#| layout-nrow: 1
labs_clev_dots <- labs(
    title = "Flipper Length Differences",
    subtitle = "Male and female penguins",
    x = "Median Flipper Length",
    y = "Island",
    color = "Sex"
)

ggp2_clev_dots <- ggplot(data = peng_clev_dots,
                mapping = aes(x = med_flip_length_mm, 
                              y = fct_rev(island))) +
                geom_line(aes(group = island), 
                    linewidth = 0.75) + 
                geom_point(aes(color = sex), 
                    size = 2.25) 

ggp2_clev_dots + 
    labs_clev_dots
```

::::

## More info

Cleveland dot plots are also helpful when comparing multiple differences on a common scale.

:::: {.panel-tabset}

### Data

::: {style="font-size: 0.90em; color: #1e83c8;"}
**DATA:**
:::

::: {style="font-size: 0.85em;"}
Remove missing values from `sex`, `bill_length_mm` and `bill_depth_mm`, and group on `sex` and `island` to the calculate the median bill length and median bill depth. These variables need to have 'showtime-ready' names because they'll be used in our facets. 
After un-grouping the data, pivot the new columns into a long (tidy) format with `median_measure` containing the name of the variable, and `median_value` containing the numbers. 

Finally, convert `median_measure` into a factor. 

:::

::: {style="font-size: 0.75em;"}
```{r}
#| label: data_code_clev_dots2
#| eval: true
#| echo: true
peng_clev_dots2 <- palmerpenguins::penguins |>
    dplyr::filter(!is.na(sex) & 
            !is.na(bill_length_mm) & 
                !is.na(bill_depth_mm)) |>
    dplyr::group_by(sex, island) |>
    dplyr::summarise(
        `Median Bill Length` = median(bill_length_mm),
        `Median Bill Depth` = median(bill_depth_mm)) |>
    dplyr::ungroup() |> 
    tidyr::pivot_longer(cols = starts_with("Med"), 
        names_to = "median_measure", 
        values_to = "median_value") |> 
    dplyr::mutate(median_measure = factor(median_measure))
glimpse(peng_clev_dots2)
```
:::

### Graph

::: {style="font-size: 0.90em; color: #1e83c8;"}
**GRAPH:**
:::

::: {style="font-size: 0.85em;"}

Re-create labels

Map the `median_value` to the `x` axis, and `island` to the `y` axis, but wrap `island` in `forcats::fct_rev()`.

Add `geom_line()`, and map `island` to the `group` aesthetic. Set the `linewidth` to `0.75`

Add `geom_point()` and map `sex` to `color` aesthetic. Set the `size` to `2.25`

Add `facet_wrap()` and facet by `median_measure`, setting `shrink` to `TRUE` and `scales` to `"free_x"`

:::

::: {style="font-size: 0.75em;"}
```{r}
#| label: graph_run_clev_dots2
#| eval: true
#| echo: true
#| out-height: '100%'
#| out-width: '100%'
#| column: page-inset-right
#| layout-nrow: 1
labs_clev_dots2 <- labs(
    title = "Penguin Measurements Differences",
    subtitle = "Male and female penguins",
    x = "Median Bill Length/Depth (mm)",
    y = "Island",
    color = "Sex"
)

ggp2_clev_dots2 <- ggplot(data = peng_clev_dots2,
                mapping = aes(x = median_value, 
                              y = fct_rev(island))) +
                    geom_line(aes(group = island), 
                        linewidth = 0.75) +
                    geom_point(aes(color = sex), 
                        size = 2.25) +
                    facet_wrap(. ~ median_measure, 
                        shrink = TRUE, 
                        scales = "free_x")

ggp2_clev_dots2 +
    labs_clev_dots2
```
:::

::::
